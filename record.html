<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Workout Record</title>
</head>
<body>
  <h1>Workout Record</h1>

  <form id="recordForm">
    <label>Date: <input type="date" name="date" required></label><br />
    <label>Running Time (minutes): <input type="number" name="runningTime" required></label><br />
    <label>Walk Time (minutes): <input type="number" name="walkTime" required></label><br />
    <label>Coach Homework (times): <input type="number" name="coachHomework" required></label><br />
    <button type="submit">Submit</button>
  </form>

  <h2>History</h2>
  <div id="records">載入中...</div>

  <script>
    // 載入紀錄
    function loadRecords() {
      google.script.run.withSuccessHandler(function(data) {
        const container = document.getElementById('records');
        container.innerHTML = '';

        if (!data || data.length === 0) {
          container.innerText = "目前沒有紀錄。";
          return;
        }

        data.forEach(row => {
          const formattedDate = new Date(row.date).toLocaleDateString();
          container.innerHTML += `<p>${formattedDate} - 跑步：${row.runningTime} 分鐘，走路：${row.walkTime} 分鐘，教練作業：${row.coachHomework} 次</p>`;
        });
      }).getRecords();
    }

    // 表單送出事件
    document.getElementById('recordForm').addEventListener('submit', function(e) {
      e.preventDefault();

      const formData = new FormData(this);
      const data = {
        date: formData.get('date'),
        runningTime: Number(formData.get('runningTime')),
        walkTime: Number(formData.get('walkTime')),
        coachHomework: Number(formData.get('coachHomework'))
      };

      google.script.run
        .withSuccessHandler(function() {
          alert("新增成功！");
          document.getElementById('recordForm').reset();
          loadRecords();
        })
        .withFailureHandler(function(error) {
          alert("發生錯誤：" + error.message);
        })
        .addRecord(data);
    });

    window.onload = loadRecords;
  </script>
</body>
</html>
